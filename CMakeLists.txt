CMAKE_MINIMUM_REQUIRED(VERSION 3.10)

project(Nraster CXX)

IF(NOT CMAKE_BUILD_TYPE)
	SET(CMAKE_BUILD_TYPE Debug)
ENDIF()

OPTION(BUILD_TESTS "builds the test directory and gtest" ON)
OPTION(BUILD_DEMOS "builds the demo directory" OFF)

OPTION(FIND_GTEST "find installed gtest instead of building it" OFF)

FIND_PACKAGE(OpenGL REQUIRED)
FIND_PACKAGE(OpenCL REQUIRED)
FIND_PACKAGE(GLEW REQUIRED)

SET(CMAKE_CXX_STANDARD 17)

IF(WIN32)
	SET(gtest_force_shared_crt ON)
ENDIF(WIN32)

ADD_SUBDIRECTORY(dependencies)

ADD_SUBDIRECTORY(lib)

IF(BUILD_DEMOS)
	ADD_SUBDIRECTORY(demo)
ENDIF()

IF(BUILD_TESTS)
	SET(NRASTER_ALL_INCLUDES ${PROJECT_SOURCE_DIR}/lib/inc)
	
	ADD_SUBDIRECTORY(test)
	ENABLE_TESTING()
	ADD_TEST(NAME AllTests COMMAND NrasterTest) # run the executable itself for a better log as it uses GTest

	UNSET(NRASTER_ALL_INCLUDES)
ENDIF()

